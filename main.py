import folium
from branca.colormap import LinearColormap
from folium.plugins import HeatMap, MiniMap
import json
import random

# 生成模拟数据（假设人口密度）
def generate_density(name):
    return random.randint(1000, 10000)  # 随机生成演示数据

# 生成色阶
color_gradient = {
    1000: '#FFEDA0',
    3000: '#FED976',
    5000: '#FEB24C',
    7000: '#FD8D3C',
    9000: '#FC4E2A',
    10000: '#BD0026'
}

# 加载你的 GeoJSON 数据
geojson_data = {
    "type": "FeatureCollection",
    "name": "bj",
    "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
    "features": [{ "type": "Feature", "properties": { "adcode": 110101, "name": "东城区", "center": [ 116.418757, 39.917544 ], "centroid": [ 116.416718, 39.912934 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.44364, 39.87284 ], [ 116.445648, 39.879283 ], [ 116.444059, 39.890038 ], [ 116.450939, 39.890249 ], [ 116.450876, 39.894088 ], [ 116.447154, 39.894186 ], [ 116.446819, 39.900042 ], [ 116.448722, 39.903246 ], [ 116.436488, 39.902042 ], [ 116.434983, 39.913964 ], [ 116.434314, 39.92868 ], [ 116.443682, 39.928664 ], [ 116.443703, 39.936663 ], [ 116.446338, 39.946205 ], [ 116.440566, 39.945295 ], [ 116.442239, 39.9497 ], [ 116.435422, 39.952121 ], [ 116.436698, 39.949245 ], [ 116.429483, 39.950155 ], [ 116.429002, 39.957274 ], [ 116.424861, 39.962279 ], [ 116.414196, 39.962182 ], [ 116.411415, 39.964928 ], [ 116.411101, 39.97146 ], [ 116.407504, 39.973995 ], [ 116.40788, 39.962182 ], [ 116.389498, 39.96314 ], [ 116.387658, 39.96093 ], [ 116.38678, 39.957014 ], [ 116.393346, 39.957355 ], [ 116.394266, 39.940629 ], [ 116.396169, 39.94006 ], [ 116.396692, 39.928306 ], [ 116.399474, 39.923574 ], [ 116.392175, 39.92242 ], [ 116.392259, 39.907881 ], [ 116.395563, 39.907995 ], [ 116.396086, 39.89944 ], [ 116.397612, 39.898675 ], [ 116.399097, 39.872205 ], [ 116.38059, 39.871148 ], [ 116.380632, 39.866054 ], [ 116.387888, 39.867372 ], [ 116.394956, 39.862734 ], [ 116.3955, 39.858682 ], [ 116.406856, 39.859967 ], [ 116.41246, 39.858942 ], [ 116.41589, 39.863645 ], [ 116.413652, 39.871148 ], [ 116.423209, 39.872824 ], [ 116.442574, 39.87188 ], [ 116.44364, 39.87284 ] ] ] ] } },
{ "type": "Feature", "properties": { "adcode": 110102, "name": "西城区", "center": [ 116.366794, 39.915309 ], "centroid": [ 116.36567, 39.912028 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.325799, 39.896789 ], [ 116.32582, 39.891111 ], [ 116.320759, 39.881512 ], [ 116.321324, 39.875199 ], [ 116.326636, 39.876859 ], [ 116.335273, 39.875183 ], [ 116.341567, 39.876159 ], [ 116.344286, 39.873653 ], [ 116.349472, 39.873588 ], [ 116.35058, 39.86869 ], [ 116.38059, 39.871148 ], [ 116.399097, 39.872205 ], [ 116.397612, 39.898675 ], [ 116.396086, 39.89944 ], [ 116.395563, 39.907995 ], [ 116.392259, 39.907881 ], [ 116.392175, 39.92242 ], [ 116.399474, 39.923574 ], [ 116.396692, 39.928306 ], [ 116.396169, 39.94006 ], [ 116.394266, 39.940629 ], [ 116.393346, 39.957355 ], [ 116.38678, 39.957014 ], [ 116.387658, 39.96093 ], [ 116.390084, 39.968406 ], [ 116.394162, 39.969397 ], [ 116.394099, 39.972858 ], [ 116.380903, 39.972712 ], [ 116.380401, 39.968178 ], [ 116.370384, 39.967902 ], [ 116.371974, 39.948594 ], [ 116.356206, 39.944092 ], [ 116.352023, 39.950854 ], [ 116.352421, 39.943832 ], [ 116.341442, 39.941979 ], [ 116.332889, 39.944092 ], [ 116.327953, 39.942369 ], [ 116.333056, 39.938565 ], [ 116.334645, 39.922664 ], [ 116.335356, 39.898448 ], [ 116.337301, 39.89739 ], [ 116.325799, 39.896789 ] ] ] ] } },
{ "type": "Feature", "properties": { "adcode": 110105, "name": "朝阳区", "center": [ 116.486409, 39.921489 ], "centroid": [ 116.513687, 39.951064 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.595548, 40.01751 ], [ 116.577814, 40.027512 ], [ 116.578797, 40.033097 ], [ 116.570474, 40.032431 ], [ 116.564242, 40.039655 ], [ 116.550753, 40.045499 ], [ 116.54655, 40.048956 ], [ 116.552761, 40.05488 ], [ 116.551757, 40.059765 ], [ 116.547784, 40.062718 ], [ 116.543183, 40.059408 ], [ 116.534379, 40.066791 ], [ 116.525993, 40.071334 ], [ 116.513948, 40.070426 ], [ 116.506775, 40.074352 ], [ 116.49933, 40.080387 ], [ 116.486657, 40.081036 ], [ 116.482935, 40.083745 ], [ 116.473545, 40.085562 ], [ 116.471015, 40.08939 ], [ 116.466832, 40.090185 ], [ 116.466247, 40.08235 ], [ 116.461855, 40.080825 ], [ 116.462608, 40.076786 ], [ 116.458823, 40.075796 ], [ 116.458635, 40.070377 ], [ 116.462127, 40.06731 ], [ 116.459408, 40.059992 ], [ 116.45142, 40.06129 ], [ 116.451629, 40.058759 ], [ 116.442867, 40.061323 ], [ 116.433268, 40.06228 ], [ 116.415618, 40.056 ], [ 116.409595, 40.055626 ], [ 116.406124, 40.049768 ], [ 116.408884, 40.043291 ], [ 116.405266, 40.038974 ], [ 116.395333, 40.036766 ], [ 116.39297, 40.041733 ], [ 116.390649, 40.041279 ], [ 116.390251, 40.036587 ], [ 116.395103, 40.032854 ], [ 116.378708, 40.031181 ], [ 116.350873, 40.0267 ], [ 116.376554, 39.992971 ], [ 116.381196, 39.977976 ], [ 116.380903, 39.972712 ], [ 116.394099, 39.972858 ], [ 116.394162, 39.969397 ], [ 116.390084, 39.968406 ], [ 116.387658, 39.96093 ], [ 116.389498, 39.96314 ], [ 116.40788, 39.962182 ], [ 116.407504, 39.973995 ], [ 116.411101, 39.97146 ], [ 116.411415, 39.964928 ], [ 116.414196, 39.962182 ], [ 116.424861, 39.962279 ], [ 116.429002, 39.957274 ], [ 116.429483, 39.950155 ], [ 116.436698, 39.949245 ], [ 116.435422, 39.952121 ], [ 116.442239, 39.9497 ], [ 116.440566, 39.945295 ], [ 116.446338, 39.946205 ], [ 116.443703, 39.936663 ], [ 116.443682, 39.928664 ], [ 116.434314, 39.92868 ], [ 116.434983, 39.913964 ], [ 116.436488, 39.902042 ], [ 116.448722, 39.903246 ], [ 116.446819, 39.900042 ], [ 116.447154, 39.894186 ], [ 116.450876, 39.894088 ], [ 116.450939, 39.890249 ], [ 116.444059, 39.890038 ], [ 116.445648, 39.879283 ], [ 116.44364, 39.87284 ], [ 116.442971, 39.866087 ], [ 116.446359, 39.860862 ], [ 116.448178, 39.863645 ], [ 116.454222, 39.859381 ], [ 116.456062, 39.86122 ], [ 116.463319, 39.856224 ], [ 116.467794, 39.856012 ], [ 116.460308, 39.848622 ], [ 116.451148, 39.852008 ], [ 116.450479, 39.848704 ], [ 116.445983, 39.848329 ], [ 116.446694, 39.84426 ], [ 116.442323, 39.843674 ], [ 116.440587, 39.839653 ], [ 116.436739, 39.841329 ], [ 116.432055, 39.832929 ], [ 116.425217, 39.831903 ], [ 116.430068, 39.830112 ], [ 116.43699, 39.830649 ], [ 116.436677, 39.827425 ], [ 116.44592, 39.826692 ], [ 116.443912, 39.82096 ], [ 116.452737, 39.823012 ], [ 116.462775, 39.815945 ], [ 116.468463, 39.814511 ], [ 116.474256, 39.809772 ], [ 116.485256, 39.81272 ], [ 116.485632, 39.816889 ], [ 116.495357, 39.818795 ], [ 116.498201, 39.8157 ], [ 116.505813, 39.817866 ], [ 116.502801, 39.819006 ], [ 116.510142, 39.821449 ], [ 116.510602, 39.827637 ], [ 116.516164, 39.829835 ], [ 116.525366, 39.829754 ], [ 116.525868, 39.826904 ], [ 116.534944, 39.82482 ], [ 116.538143, 39.828207 ], [ 116.533187, 39.832733 ], [ 116.542681, 39.830209 ], [ 116.543664, 39.835078 ], [ 116.558596, 39.834687 ], [ 116.569386, 39.833498 ], [ 116.577145, 39.830682 ], [ 116.577479, 39.827539 ], [ 116.587015, 39.828223 ], [ 116.583732, 39.824917 ], [ 116.591595, 39.823875 ], [ 116.59147, 39.826367 ], [ 116.599228, 39.825585 ], [ 116.598977, 39.831659 ], [ 116.60224, 39.831675 ], [ 116.601905, 39.840727 ], [ 116.608367, 39.846539 ], [ 116.604666, 39.846132 ], [ 116.604185, 39.850071 ], [ 116.613449, 39.850185 ], [ 116.626958, 39.860683 ], [ 116.619994, 39.868951 ], [ 116.62493, 39.87725 ], [ 116.624323, 39.881155 ], [ 116.628987, 39.881594 ], [ 116.627585, 39.890477 ], [ 116.615603, 39.889794 ], [ 116.61531, 39.895503 ], [ 116.621019, 39.898854 ], [ 116.623361, 39.904271 ], [ 116.620245, 39.90767 ], [ 116.623006, 39.913818 ], [ 116.620956, 39.923103 ], [ 116.630576, 39.921672 ], [ 116.624156, 39.929981 ], [ 116.6293, 39.931314 ], [ 116.629677, 39.938727 ], [ 116.633441, 39.940906 ], [ 116.630492, 39.946156 ], [ 116.632228, 39.950545 ], [ 116.645277, 39.945977 ], [ 116.643081, 39.952983 ], [ 116.641827, 39.969575 ], [ 116.639819, 39.982606 ], [ 116.634026, 39.981696 ], [ 116.63365, 39.986197 ], [ 116.639129, 39.986879 ], [ 116.640321, 39.990177 ], [ 116.643751, 39.989608 ], [ 116.642684, 39.996755 ], [ 116.637582, 40.002359 ], [ 116.63273, 39.999825 ], [ 116.625766, 40.003122 ], [ 116.628129, 40.007653 ], [ 116.61989, 40.011794 ], [ 116.60132, 40.013873 ], [ 116.595548, 40.01751 ] ] ], [ [ [ 116.603683, 40.052949 ], [ 116.608409, 40.054912 ], [ 116.603473, 40.086811 ], [ 116.602909, 40.093883 ], [ 116.598392, 40.103874 ], [ 116.598705, 40.09351 ], [ 116.595903, 40.090218 ], [ 116.580365, 40.088352 ], [ 116.578316, 40.102739 ], [ 116.574071, 40.107815 ], [ 116.574322, 40.096138 ], [ 116.578149, 40.076461 ], [ 116.581411, 40.067846 ], [ 116.58139, 40.073817 ], [ 116.586597, 40.074336 ], [ 116.590131, 40.056162 ], [ 116.587957, 40.05053 ], [ 116.591198, 40.051796 ], [ 116.591993, 40.043129 ], [ 116.599814, 40.041408 ], [ 116.599417, 40.047171 ], [ 116.601633, 40.047658 ], [ 116.598517, 40.052543 ], [ 116.603683, 40.052949 ] ] ] ] } },
{ "type": "Feature", "properties": { "adcode": 110106, "name": "丰台区", "center": [ 116.286968, 39.863642 ], "centroid": [ 116.250342, 39.835716 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.259089, 39.896658 ], [ 116.252899, 39.896382 ], [ 116.233534, 39.89212 ], [ 116.234642, 39.88955 ], [ 116.227783, 39.889078 ], [ 116.22772, 39.883839 ], [ 116.222952, 39.883986 ], [ 116.219523, 39.881334 ], [ 116.219105, 39.876713 ], [ 116.210907, 39.878079 ], [ 116.212099, 39.874679 ], [ 116.208126, 39.874125 ], [ 116.20457, 39.879885 ], [ 116.199426, 39.883286 ], [ 116.19035, 39.881529 ], [ 116.179099, 39.882684 ], [ 116.167033, 39.888752 ], [ 116.163352, 39.886881 ], [ 116.156137, 39.889029 ], [ 116.150972, 39.884051 ], [ 116.147605, 39.885287 ], [ 116.13167, 39.881268 ], [ 116.125898, 39.877949 ], [ 116.119729, 39.877477 ], [ 116.112242, 39.873247 ], [ 116.105425, 39.872547 ], [ 116.104149, 39.868837 ], [ 116.095826, 39.869032 ], [ 116.087169, 39.866152 ], [ 116.078323, 39.870318 ], [ 116.07046, 39.868446 ], [ 116.067344, 39.865761 ], [ 116.070188, 39.860423 ], [ 116.070982, 39.853717 ], [ 116.056553, 39.85095 ], [ 116.05465, 39.845953 ], [ 116.061488, 39.841899 ], [ 116.068975, 39.840792 ], [ 116.07619, 39.837015 ], [ 116.078615, 39.831593 ], [ 116.084366, 39.828581 ], [ 116.085747, 39.832163 ], [ 116.089741, 39.829721 ], [ 116.088214, 39.82692 ], [ 116.089594, 39.816352 ], [ 116.086186, 39.816401 ], [ 116.084826, 39.811596 ], [ 116.087127, 39.803289 ], [ 116.0856, 39.795324 ], [ 116.091916, 39.787927 ], [ 116.091581, 39.784082 ], [ 116.094613, 39.781557 ], [ 116.101368, 39.78576 ], [ 116.107014, 39.78532 ], [ 116.106366, 39.788612 ], [ 116.119792, 39.789654 ], [ 116.120754, 39.784848 ], [ 116.125062, 39.785353 ], [ 116.131503, 39.783121 ], [ 116.132569, 39.778624 ], [ 116.127467, 39.779047 ], [ 116.124351, 39.77675 ], [ 116.121486, 39.779047 ], [ 116.117491, 39.77336 ], [ 116.121465, 39.761626 ], [ 116.12847, 39.762409 ], [ 116.133803, 39.76663 ], [ 116.148044, 39.766483 ], [ 116.148902, 39.768651 ], [ 116.15597, 39.766923 ], [ 116.162704, 39.769205 ], [ 116.16971, 39.784278 ], [ 116.182989, 39.783707 ], [ 116.183365, 39.780204 ], [ 116.188008, 39.781785 ], [ 116.194407, 39.780579 ], [ 116.194449, 39.778493 ], [ 116.200388, 39.778151 ], [ 116.201852, 39.788269 ], [ 116.201852, 39.799657 ], [ 116.208063, 39.806352 ], [ 116.207415, 39.810814 ], [ 116.216762, 39.816905 ], [ 116.214462, 39.818974 ], [ 116.214127, 39.824706 ], [ 116.227219, 39.825048 ], [ 116.228306, 39.827197 ], [ 116.23962, 39.826872 ], [ 116.243007, 39.825145 ], [ 116.244304, 39.818567 ], [ 116.251644, 39.81329 ], [ 116.25361, 39.807231 ], [ 116.250933, 39.801432 ], [ 116.251519, 39.793059 ], [ 116.259298, 39.797621 ], [ 116.262184, 39.792782 ], [ 116.27423, 39.796936 ], [ 116.287237, 39.799103 ], [ 116.289182, 39.795894 ], [ 116.296083, 39.795568 ], [ 116.291148, 39.793271 ], [ 116.295205, 39.790958 ], [ 116.301541, 39.774941 ], [ 116.307062, 39.770085 ], [ 116.31068, 39.772057 ], [ 116.317978, 39.783447 ], [ 116.321784, 39.783626 ], [ 116.322872, 39.798386 ], [ 116.326824, 39.798386 ], [ 116.328225, 39.801416 ], [ 116.340124, 39.802149 ], [ 116.341755, 39.807589 ], [ 116.355704, 39.805668 ], [ 116.356833, 39.800471 ], [ 116.367039, 39.79982 ], [ 116.368189, 39.794819 ], [ 116.365742, 39.794151 ], [ 116.367582, 39.784962 ], [ 116.378478, 39.785646 ], [ 116.379209, 39.77939 ], [ 116.385609, 39.778852 ], [ 116.390649, 39.780465 ], [ 116.391903, 39.765277 ], [ 116.398888, 39.765864 ], [ 116.397905, 39.781068 ], [ 116.396023, 39.786738 ], [ 116.42024, 39.787439 ], [ 116.421034, 39.794134 ], [ 116.429274, 39.794102 ], [ 116.429399, 39.803583 ], [ 116.425719, 39.805358 ], [ 116.422456, 39.81044 ], [ 116.417772, 39.81013 ], [ 116.415262, 39.812525 ], [ 116.410013, 39.811336 ], [ 116.41016, 39.817052 ], [ 116.419759, 39.815375 ], [ 116.418441, 39.822915 ], [ 116.414426, 39.824282 ], [ 116.415785, 39.829428 ], [ 116.420072, 39.826611 ], [ 116.425217, 39.831903 ], [ 116.432055, 39.832929 ], [ 116.436739, 39.841329 ], [ 116.440587, 39.839653 ], [ 116.442323, 39.843674 ], [ 116.446694, 39.84426 ], [ 116.445983, 39.848329 ], [ 116.450479, 39.848704 ], [ 116.451148, 39.852008 ], [ 116.460308, 39.848622 ], [ 116.467794, 39.856012 ], [ 116.463319, 39.856224 ], [ 116.456062, 39.86122 ], [ 116.454222, 39.859381 ], [ 116.448178, 39.863645 ], [ 116.446359, 39.860862 ], [ 116.442971, 39.866087 ], [ 116.44364, 39.87284 ], [ 116.442574, 39.87188 ], [ 116.423209, 39.872824 ], [ 116.413652, 39.871148 ], [ 116.41589, 39.863645 ], [ 116.41246, 39.858942 ], [ 116.406856, 39.859967 ], [ 116.3955, 39.858682 ], [ 116.394956, 39.862734 ], [ 116.387888, 39.867372 ], [ 116.380632, 39.866054 ], [ 116.38059, 39.871148 ], [ 116.35058, 39.86869 ], [ 116.349472, 39.873588 ], [ 116.344286, 39.873653 ], [ 116.341567, 39.876159 ], [ 116.335273, 39.875183 ], [ 116.326636, 39.876859 ], [ 116.321324, 39.875199 ], [ 116.320759, 39.881512 ], [ 116.32582, 39.891111 ], [ 116.325799, 39.896789 ], [ 116.314026, 39.896772 ], [ 116.302796, 39.891925 ], [ 116.295016, 39.886833 ], [ 116.294975, 39.896496 ], [ 116.266199, 39.896252 ], [ 116.259089, 39.896658 ] ] ] ] } },
{ "type": "Feature", "properties": { "adcode": 110107, "name": "石景山区", "center": [ 116.195445, 39.914601 ], "centroid": [ 116.176229, 39.933205 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.167033, 39.888752 ], [ 116.179099, 39.882684 ], [ 116.19035, 39.881529 ], [ 116.199426, 39.883286 ], [ 116.20457, 39.879885 ], [ 116.208126, 39.874125 ], [ 116.212099, 39.874679 ], [ 116.210907, 39.878079 ], [ 116.219105, 39.876713 ], [ 116.219523, 39.881334 ], [ 116.222952, 39.883986 ], [ 116.22772, 39.883839 ], [ 116.227783, 39.889078 ], [ 116.234642, 39.88955 ], [ 116.233534, 39.89212 ], [ 116.252899, 39.896382 ], [ 116.259089, 39.896658 ], [ 116.252983, 39.896951 ], [ 116.252983, 39.915558 ], [ 116.250975, 39.919834 ], [ 116.237696, 39.918452 ], [ 116.232426, 39.91694 ], [ 116.230899, 39.919525 ], [ 116.206787, 39.916663 ], [ 116.207707, 39.9259 ], [ 116.215696, 39.927103 ], [ 116.213061, 39.928891 ], [ 116.216198, 39.931233 ], [ 116.213186, 39.933232 ], [ 116.216281, 39.936386 ], [ 116.215466, 39.94375 ], [ 116.212831, 39.948952 ], [ 116.20112, 39.961109 ], [ 116.190747, 39.965367 ], [ 116.190685, 39.968259 ], [ 116.185812, 39.970274 ], [ 116.18531, 39.977976 ], [ 116.186586, 39.983906 ], [ 116.178911, 39.988292 ], [ 116.178012, 39.982216 ], [ 116.171487, 39.977001 ], [ 116.169229, 39.979357 ], [ 116.166845, 39.987561 ], [ 116.158124, 39.984133 ], [ 116.156117, 39.989137 ], [ 116.151579, 39.993442 ], [ 116.144678, 39.989186 ], [ 116.118934, 39.986115 ], [ 116.113455, 39.981518 ], [ 116.116592, 39.971932 ], [ 116.122971, 39.967561 ], [ 116.120712, 39.96119 ], [ 116.115254, 39.957745 ], [ 116.120043, 39.950789 ], [ 116.114522, 39.949196 ], [ 116.11195, 39.942921 ], [ 116.119875, 39.932761 ], [ 116.124769, 39.934907 ], [ 116.127822, 39.930338 ], [ 116.127341, 39.926615 ], [ 116.13029, 39.924518 ], [ 116.139282, 39.922095 ], [ 116.146852, 39.910077 ], [ 116.152792, 39.906629 ], [ 116.153503, 39.900985 ], [ 116.161094, 39.896805 ], [ 116.167033, 39.888752 ] ] ] ] } },
{ "type": "Feature", "properties": { "adcode": 110108, "name": "海淀区", "center": [ 116.310316, 39.956074 ], "centroid": [ 116.23328, 40.026927 ], "childrenNum": 0, "level": "district", "acroutes": [ 100000, 110000 ] }, "geometry": { "type": "MultiPolygon", "coordinates": [ [ [ [ 116.325799, 39.896789 ], [ 116.337301, 39.89739 ], [ 116.335356, 39.898448 ], [ 116.334645, 39.922664 ], [ 116.333056, 39.938565 ], [ 116.327953, 39.942369 ], [ 116.332889, 39.944092 ], [ 116.341442, 39.941979 ], [ 116.352421, 39.943832 ], [ 116.352023, 39.950854 ], [ 116.356206, 39.944092 ], [ 116.371974, 39.948594 ], [ 116.370384, 39.967902 ], [ 116.380401, 39.968178 ], [ 116.380903, 39.972712 ], [ 116.381196, 39.977976 ], [ 116.376554, 39.992971 ], [ 116.350873, 40.0267 ], [ 116.378708, 40.031181 ], [ 116.395103, 40.032854 ], [ 116.390251, 40.036587 ], [ 116.390649, 40.041279 ], [ 116.38519, 40.042853 ], [ 116.376888, 40.042756 ], [ 116.376114, 40.045466 ], [ 116.36959, 40.04696 ], [ 116.367394, 40.053436 ], [ 116.372999, 40.054344 ], [ 116.372267, 40.05785 ], [ 116.379272, 40.059002 ], [ 116.382848, 40.061582 ], [ 116.381928, 40.066402 ], [ 116.373354, 40.065623 ], [ 116.372538, 40.06843 ], [ 116.363149, 40.068965 ], [ 116.363023, 40.065931 ], [ 116.357293, 40.066012 ], [ 116.34667, 40.063659 ], [ 116.346963, 40.06043 ], [ 116.342676, 40.059635 ], [ 116.343366, 40.055448 ], [ 116.340271, 40.055091 ], [ 116.338828, 40.058921 ], [ 116.330756, 40.063383 ], [ 116.331801, 40.057168 ], [ 116.325946, 40.054799 ], [ 116.318292, 40.061663 ], [ 116.309446, 40.060609 ], [ 116.305995, 40.063043 ], [ 116.302942, 40.060803 ], [ 116.290353, 40.083145 ], [ 116.279897, 40.079754 ], [ 116.2731, 40.092699 ], [ 116.27333, 40.09557 ], [ 116.265237, 40.094694 ], [ 116.258273, 40.101522 ], [ 116.263899, 40.10402 ], [ 116.263334, 40.110588 ], [ 116.258022, 40.11195 ], [ 116.25957, 40.106907 ], [ 116.255868, 40.104474 ], [ 116.252732, 40.106517 ], [ 116.245956, 40.10535 ], [ 116.240498, 40.108009 ], [ 116.243363, 40.113279 ], [ 116.241836, 40.118403 ], [ 116.245036, 40.118825 ], [ 116.247043, 40.136204 ], [ 116.233785, 40.136577 ], [ 116.215445, 40.143174 ], [ 116.212224, 40.140548 ], [ 116.206285, 40.143092 ], [ 116.205658, 40.150175 ], [ 116.203211, 40.153773 ], [ 116.202166, 40.160984 ], [ 116.194282, 40.160076 ], [ 116.192065, 40.155669 ], [ 116.182696, 40.158099 ], [ 116.183094, 40.153335 ], [ 116.180417, 40.14729 ], [ 116.174122, 40.143595 ], [ 116.167681, 40.141844 ], [ 116.168622, 40.135442 ], [ 116.17178, 40.127936 ], [ 116.167409, 40.128455 ], [ 116.169563, 40.124564 ], [ 116.152708, 40.121776 ], [ 116.132925, 40.121354 ], [ 116.132214, 40.115079 ], [ 116.127676, 40.116393 ], [ 116.113309, 40.115598 ], [ 116.105864, 40.118014 ], [ 116.102246, 40.115987 ], [ 116.096056, 40.121257 ], [ 116.089783, 40.119327 ], [ 116.08445, 40.120252 ], [ 116.077883, 40.115047 ], [ 116.073847, 40.115436 ], [ 116.072676, 40.109258 ], [ 116.069456, 40.104912 ], [ 116.062931, 40.10282 ], [ 116.061969, 40.09956 ], [ 116.055905, 40.09643 ], [ 116.051848, 40.091661 ], [ 116.048878, 40.085303 ], [ 116.051325, 40.084345 ], [ 116.054587, 40.07823 ], [ 116.064019, 40.073022 ], [ 116.064981, 40.067456 ], [ 116.071129, 40.062037 ], [ 116.068055, 40.051926 ], [ 116.075123, 40.039915 ], [ 116.078176, 40.032756 ], [ 116.084241, 40.030905 ], [ 116.095073, 40.031782 ], [ 116.098398, 40.033811 ], [ 116.105488, 40.032204 ], [ 116.114522, 40.033 ], [ 116.123598, 40.029655 ], [ 116.129558, 40.0311 ], [ 116.140098, 40.02873 ], [ 116.149278, 40.022154 ], [ 116.157309, 40.021034 ], [ 116.163938, 40.016796 ], [ 116.164774, 40.014328 ], [ 116.175335, 40.006403 ], [ 116.172115, 40.000637 ], [ 116.161658, 39.999987 ], [ 116.154527, 39.997275 ], [ 116.151579, 39.993442 ], [ 116.156117, 39.989137 ], [ 116.158124, 39.984133 ], [ 116.166845, 39.987561 ], [ 116.169229, 39.979357 ], [ 116.171487, 39.977001 ], [ 116.178012, 39.982216 ], [ 116.178911, 39.988292 ], [ 116.186586, 39.983906 ], [ 116.18531, 39.977976 ], [ 116.185812, 39.970274 ], [ 116.190685, 39.968259 ], [ 116.190747, 39.965367 ], [ 116.20112, 39.961109 ], [ 116.212831, 39.948952 ], [ 116.215466, 39.94375 ], [ 116.216281, 39.936386 ], [ 116.213186, 39.933232 ], [ 116.216198, 39.931233 ], [ 116.213061, 39.928891 ], [ 116.215696, 39.927103 ], [ 116.207707, 39.9259 ], [ 116.206787, 39.916663 ], [ 116.230899, 39.919525 ], [ 116.232426, 39.91694 ], [ 116.237696, 39.918452 ], [ 116.250975, 39.919834 ], [ 116.252983, 39.915558 ], [ 116.252983, 39.896951 ], [ 116.259089, 39.896658 ], [ 116.266199, 39.896252 ], [ 116.294975, 39.896496 ], [ 116.295016, 39.886833 ], [ 116.302796, 39.891925 ], [ 116.314026, 39.896772 ], [ 116.325799, 39.896789 ] ] ] ] } }
]
}
for feature in geojson_data['features']:
    feature['properties']['density'] = generate_density(feature['properties']['name'])


# 真实数据配置
district_data = {
    "东城区": {"population": 70.3, "area": 41.84},  # 人口(万人), 面积(km²)
    "西城区": {"population": 109.9, "area": 50.7},
    "朝阳区": {"population": 373.9, "area": 465},
    "海淀区": {"population": 312.5, "area": 431},
    "丰台区": {"population": 201.1, "area": 306},
    "石景山区": {"population": 56.4, "area": 84}
}

# 计算人口密度（人/平方公里）并验证数据
for name, data in district_data.items():
    try:
        data["density"] = (data["population"] * 10000) / data["area"]
    except ZeroDivisionError:
        raise ValueError(f"{name}的面积不能为零")
    except KeyError as e:
        raise KeyError(f"数据字段缺失: {e}")

# 创建专业级颜色映射
density_values = [v["density"] for v in district_data.values()]
colormap = LinearColormap(
    colors=['#ffffcc', '#a1dab4', '#41b6c4', '#2c7fb8', '#253494'],
    vmin=min(density_values),
    vmax=max(density_values),
    caption='人口密度（人/km²）'
)

# 将数据绑定到GeoJSON（带异常保护）
for feature in geojson_data['features']:
    name = feature['properties']['name']
    if name in district_data:
        data = district_data[name]
        feature['properties'].update({
            'population': f"{data['population']} 万人",
            'area': f"{data['area']} km²",
            'density': f"{data['density']:,.0f} 人/km²"
        })
    else:
        print(f"警告: 未找到 {name} 的对应数据，已跳过")

# 创建地图
m = folium.Map(location=[39.917544, 116.418757],
               zoom_start=11,
               tiles='cartodbpositron',
               control_scale=True)

# 添加专业级GeoJSON层
folium.GeoJson(
    geojson_data,
    name='人口经济指标',
    style_function=lambda feature: {
        'fillColor': colormap(district_data.get(feature['properties']['name'], {}).get("density", 0)),
        'color': '#444',
        'weight': 1,
        'fillOpacity': 0.7
    },
    tooltip=folium.GeoJsonTooltip(
        fields=['name', 'population', 'area', 'density'],
        aliases=['行政区', '人口', '面积', '人口密度'],
        style=('background: rgba(255,255,255,0.9); border:1px solid #cccccc;')
    )
).add_to(m)

# 添加图例
colormap.add_to(m)

# 添加专业控件
MiniMap(position='bottomleft').add_to(m)
folium.LayerControl(position='topright').add_to(m)

# 添加动态样式
m.get_root().html.add_child(folium.Element('''
<style>
    .leaflet-tooltip {
        font-family: "Microsoft YaHei";
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        border-radius: 4px;
        padding: 8px 12px;
    }
    .legend {
        background: rgba(255,255,255,0.8) !important;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
        padding: 10px;
    }
</style>
'''))

# 保存并展示
m.save('beijing_population_density.html')
m